syntax = "proto3";

package grpc;

message Empty {}

enum State {
  UNDEFINED = 0;
  NEW = 1;
  START = 2;
  ACTIVE = 6;
  ENDED = 7;
}

enum Command {
  TICK = 0;
  UPDATE_INFO = 1;
  SET_DESTINATION = 2;
  END = 3;
}

enum VehicleState {
  REGISTERING = 0;
  CARLA_UPDATE = 1;
  TICK_UPDATE = 2;
  OK = 3;
}

message SimulationState {
  State state = 1;
  int32 tick_id = 2;
  int32 vehicle_index = 3;
  string test_scenario = 4;
  string application = 5;
  string version = 6;
  Command command = 7;
  string params_json = 8;
  int32 message_hash = 9; // use as a UID for message indentification when Server needs an ack
}

message VehicleUpdate {
  int32 tick_id = 1;
  int32 vehicle_index = 2;
  string vid = 3;
  int32 actor_id = 4;
  VehicleState vehicle_state = 5;
  int32 message_hash = 6; // use as a UID for message indentification when Server needs an ack
}

service OpenCDA {
  rpc SimulationStateStream (Empty) returns (stream SimulationState);
  rpc SendUpdate (VehicleUpdate) returns (Empty);
  rpc RegisterVehicle (VehicleUpdate) returns (SimulationState);
}